var jktable=function(s){var i=this;var m=function(E,F){jQuery.each(F,function(G,H){if(jQuery.type(E[G])!="undefined"){if(jQuery.type(E[G])=="boolean"){if(jQuery.type(H)=="object"&&jQuery.type(H.enable)!="undefined"){F[G].enable=E[G];}else{F[G]=E[G];}}else{if(jQuery.type(F[G])=="object"){m(E[G],F[G]);}else{F[G]=E[G];}}}});};var d={header:"",data:"",searchable:false};var p={data:ko.observableArray(),primary:"",fields:[],ajax:{url:"",requestOnChangePage:false,pipeline:false,type:"POST"},realtimeSearch:false,datalength:0,insertButton:false,editButton:false,deleteButton:false,displayTotalData:true,pagination:{enable:false,pageSizeOptions:[10,25,50,100],pageSize:2,displayPageNo:false,pageIndex:0},header:{elem:"div",cssClass:"jkt-header",left:{elem:"div",cssClass:"jkt-headerLeft"},right:{elem:"div",cssClass:"jkt-headerRight",visible:"maxPage() > 1"}},table:{width:"100%",cssClass:"table",cellspacing:0,cellpadding:5,head:{elem:"thead",click:"",row:{elem:"tr",click:""},col:{elem:"th",click:""}},body:{elem:"tbody",click:"",bind:"displayPage",row:{elem:"tr",click:""},col:{elem:"td",click:""}}}};var v={data:ko.observableArray(),datalength:ko.observable(0),fields:{},fieldsSearchable:{},fieldsSortable:{},pageSize:ko.observable(),pageSizeOptions:[],pageIndex:ko.observable(0)};v.sortChange=function(E){alert("");};v.displayData=function(){var E=[];if(!v.fieldsSearchable){E=v.data();}else{E=ko.utils.arrayFilter(v.data(),function(G){var F=true;jQuery.each(v.fieldsSearchable,function(I,H){var J=jQuery.isFunction(G[I])?G[I]():G[I];if(H()){if(jQuery.type(J)=="string"){if(J.toLowerCase().indexOf(H().toLowerCase())==-1){F=false;return false;}}else{if(jQuery.type(J)==="number"){if(J!=H()){F=false;return false;}}}}});return F;});}if(v.fieldsSortable){E.sort(function(G,F){var H=0;jQuery.each(v.fieldsSortable,function(L,M){if(M.order()>0){var I,N;if(jQuery.isFunction(G[L])){I=G[L]();N=F[L]();}else{I=G[L];N=F[L];}var K=I;var J=N;if(jQuery.type(K)=="string"){K=K.toLowerCase();J=J.toLowerCase();}if(K==J){}else{if(M.order()==1){if(isNaN(I)||isNaN(N)){H=K>J?1:-1;}else{H=K-J;}}else{if(M.order()==2){if(isNaN(I)||isNaN(N)){H=J>K?1:-1;}else{H=J-K;}}}return false;}}});return H;});}return E;};v.maxPage=function(){var F=v.displayData();var E=v.pageSize();return Math.ceil(F.length/E);};v.pageNoOptions=function(){var G=[];var F=v.maxPage();for(var E=1;E<F+1;E++){G.push(E);}return G;};v.maxPrimary=function(){var E=v.data();return Math.max.apply(Math,jQuery.map(E,function(G,F){return jQuery.isFunction(G[p.primary])?G[p.primary]():G[p.primary];}));};v.displayPage=function(){if(f.enable){var F=v.pageSize();var E=v.pageIndex();var G=F*(E-1);return v.displayData().slice(G,G+F);}else{return v.displayData();}};v.insertButtonClick=function(){};v.gotoFirstPage=function(){v.pageIndex(1);};v.gotoPrevPage=function(){v.pageIndex(v.pageIndex()-1);};v.gotoNextPage=function(){v.pageIndex(v.pageIndex()+1);};v.gotoLastPage=function(){v.pageIndex(v.maxPage());};var a={width:"100%",cssClass:"jkt-insertButton",textClass:"",text:"Add New",click:function(){}};var x={cssClass:"jkt-Button jkt-editButton",text:"",click:"",visible:true};var u={cssClass:"jkt-Button jkt-deleteButton",text:"",click:"",visible:true};var b={cssClass:"jkt-sortButton jkt-ascButton"};var n={cssClass:"jkt-sortButton jkt-descButton"};var C={cssClass:"jkt-sortButton jkt-sortableButton"};var w={cssClass:"jkt-pageButton jkt-firstButton",textClass:"",text:"<<",visible:"pageIndex() > 1",click:"gotoFirstPage"};var z={cssClass:"jkt-pageButton jkt-prevButton",textClass:"",text:"<",visible:"pageIndex() > 1",click:"gotoPrevPage"};var l={cssClass:"jkt-pageButton jkt-nextButton",textClass:"",text:">",visible:" pageIndex() < maxPage()",click:"gotoNextPage"};var r={cssClass:"jkt-pageButton jkt-lastButton",textClass:"",text:">>",visible:" pageIndex() < maxPage() ",click:"gotoLastPage"};var k=function(){var E=false;var F={};jQuery.each(v.fieldsSearchable,function(H,G){var I=jQuery.isFunction(item[H])?item[H]():item[H];F[H]=I;});F["pageSize"]=v.pageSize();F["pageIndex"]=v.pageIndex();F["maxPrimary"]=v.maxPrimary();$.ajax({async:false,url:p.ajax,type:"POST",data:F,format:"json",success:function(G){E=G;}});return E;};var f=p.pagination;var g=p.header;var o=p.table;if(jQuery.type(s)=="object"){m(s,p);}if(jQuery.type(s.data)!="undefined"){v.data=p.data;v.datalength=ko.computed(function(){return v.data().length;});}else{v.datalength(f.datalength);v.maxPage=ko.computed(function(){return Math.ceil(v.datalength()/v.pageSize());},v);}v.pageSize(f.pageSize);v.pageSizeOptions=f.pageSizeOptions;if(v.pageSizeOptions.indexOf(v.pageSize())<0){v.pageSizeOptions.push(v.pageSize());}v.pageSizeOptions.sort(function(F,E){return F-E;});jQuery.each(p.fields,function(F,E){if(E.data){v.fields[E.data]=ko.observable("");}});if(p.editButton){if(jQuery.type(p.editButton)=="object"){jQuery.each(x,function(F,E){if(p.editButton[F]){x[F]=p.editButton[F];}});}}if(p.deleteButton){if(jQuery.type(p.deleteButton)=="object"){jQuery.each(u,function(F,E){if(p.deleteButton[F]){u[F]=p.deleteButton[F];}});}}var q=jQuery("<table>");jQuery.each(o,function(F,E){if(F=="cssClass"){q.addClass(E);}else{q.attr(""+F,E);}});if(p.fields.length>0){var A=jQuery("<"+o.head.elem+">");var B=jQuery("<"+o.head.row.elem+">");var c=jQuery("<"+o.body.elem+">");if(o.body.bind!=""){c.attr("data-bind",["foreach : "+o.body.bind]);}var e=jQuery("<"+o.body.row.elem+">");if(o.body.row.click!=""){e.attr("data-bind",["click: "+o.body.row.click]);}jQuery.each(p.fields,function(G,E){var J=jQuery("<"+o.head.col.elem+">");if(E.header!=""){J.append(jQuery("<label>").text(E.header));}var H=jQuery("<"+o.body.col.elem+">");if(jQuery.type(E.width)!="undefined"){J.width(E.width);H.width(E.width);}if(E.data){var F="";var I=0;if(jQuery.type(E.sortable)==="boolean"){if(E.sortable){F=E.data;}}else{if(jQuery.type(E.sortable)==="string"){F=E.sortable;}else{if(jQuery.type(E.sortable)==="number"){F=E.data;I=E.sortable;}}}if(F!=""){v.fieldsSortable[F]={order:ko.observable(I),change:function(){jQuery.each(v.fieldsSortable,function(N,M){if(N==F){M.order(M.order()+1);if(M.order()>2){M.order(1);}}else{M.order(0);}});}};v.fieldsSortable[F].cssClass=ko.computed(function(){if(v.fieldsSortable[F].order()==0){return C.cssClass;}else{if(v.fieldsSortable[F].order()==1){return b.cssClass;}else{if(v.fieldsSortable[F].order()==2){return n.cssClass;}}}},v.fieldsSortable[F]);J.append("&nbsp;");J.append(jQuery("<button>").attr("data-bind",["click: fieldsSortable."+F+".change","attr: {'class': fieldsSortable."+F+".cssClass }"]));}var K="";if(jQuery.type(E.searchable)==="boolean"){if(E.searchable){K=E.data;}}else{if(jQuery.type(E.searchable)==="string"){K=E.searchable;}}if(K!=""){v.fieldsSearchable[K]=ko.observable("");if(J.html()!=""){J.append("<br/>");}var L=["value: fieldsSearchable."+K];if(p.realtimeSearch){L.push("valueUpdate: 'afterkeydown'");}J.append(jQuery("<input>").attr("data-bind",L));}H.append(jQuery("<div>").addClass("data").attr("data-bind",["text: "+E.data]));H.addClass(E.cssClass);}else{if(E.buttons){jQuery.each(E.buttons,function(N,M){if(M.toLowerCase()=="edit"){H.append(jQuery("<button>").addClass(x.cssClass).text(x.text).attr("data-bind",["click: "+x.click,"visible: "+x.visible]));}else{if(M.toLowerCase()=="delete"){H.append(jQuery("<button>").addClass(u.cssClass).text(u.text).attr("data-bind",["click: "+u.click,"visible: "+u.visible]));}}});}}B.append(J);e.append(H);});A.append(B);c.append(e);if(p.insertButton){if(jQuery.type(p.insertButton)=="object"){jQuery.each(a,function(F,E){if(p.insertButton[F]){a[F]=p.insertButton[F];}});}v.insertButtonClick=a.click;var D=jQuery("<"+o.head.row.elem+">").append(jQuery("<"+o.head.col.elem+">").attr("colspan",p.fields.length).append(jQuery("<button>").addClass(a.cssClass).css("width",a.width).attr("data-bind",["click: insertButtonClick"]).append(jQuery("<span>").addClass(a.textClass).text(a.text))));A.append(D);}q.append(A);q.append(c);}var t=jQuery("<"+g.left.elem+">").addClass(g.left.cssClass);if(p.displayTotalData){t.append("Total items : ").append(jQuery("<span>").attr("data-bind",["text: datalength"])).append(", Filtered items : ").append(jQuery("<span>").attr("data-bind",["text: displayData().length"]));}var y=jQuery("<"+g.right.elem+">").addClass(g.right.cssClass).attr("data-bind",["visible: "+g.right.visible]);if(p.pagination.enable){var h=jQuery("<select>");h.attr("data-bind",["options: pageSizeOptions","value: pageSize"]);if(t.html()!=""){t.append("<br/>");}t.append("Item per Page ").append(h);var j=jQuery("<select>");j.attr("data-bind",["options: pageNoOptions","value: pageIndex"]);y.append("Page ").append(j).append(" of ").append(jQuery("<label>").attr("data-bind",["text: maxPage"]));y.append("<br/>");y.append(jQuery("<button>").addClass(w.cssClass).attr("data-bind",["click: "+w.click,"visible: "+w.visible]));y.append(jQuery("<button>").addClass(z.cssClass).attr("data-bind",["click: "+z.click,"visible: "+z.visible]));y.append(jQuery("<button>").addClass(l.cssClass).attr("data-bind",["click: "+l.click,"visible: "+l.visible]));y.append(jQuery("<button>").addClass(r.cssClass).attr("data-bind",["click: "+r.click,"visible: "+r.visible]));}jQuery(this).append(jQuery("<"+g.elem+">").addClass(g.cssClass).append(t).append(y));v.displayData=ko.computed(v.displayData,v);v.maxPage=ko.computed(v.maxPage,v);v.pageNoOptions=ko.computed(v.pageNoOptions,v);v.maxPrimary=ko.computed(v.maxPrimary,v);v.displayPage=ko.computed(v.displayPage,v);jQuery(this).append(q);ko.cleanNode(jQuery(this)[0]);ko.applyBindings(v,jQuery(this)[0]);i.jktableVM=v;i.jktableSetting=p;return v;};jQuery.fn.jktable=jktable;